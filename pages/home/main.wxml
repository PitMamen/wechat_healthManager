<wxs src="../../modules/format.wxs" module="computed"></wxs>

<van-sticky>

    <!-- <view class="search-contianer">
    <view class="" style="height:{{navHeight + 50}}px;">
      <view class="top-view2" style="height:{{navHeight + 40}}px;">
        <image src="/image/home_logo.png" style="width: 60px; height: 20px;margin-top:{{navTop + 12}}px ;" mode="aspectFit"></image>
        <view style="color: rgb(255, 255, 255,0.6);font-size: 14px;width: 100%;margin-left: 8px;margin-top: {{navTop + 13}}px;display: flex;">
          您的专属健康管家</view>
      </view>
      <view style="width: 100%;height:20px;background-color: #4179FB;border-radius: 100%;margin-top: -10px;"></view>


    </view>
  </view> -->


    <view class="header-box">

        <view class="topview2" style="background-size: cover;background-image: url('https://hmg.mclouds.org.cn/content-api/file/I20220331104628351RI6YMUTH3JWWJH-home_bg.jpg'); ">
            <image src="{{userInfo.avatarUrl || '/image/avatar.png'}}" class="top-image" mode="aspectFill"  binderror="avatarBinderror" />
            <block wx:if="{{defaultPatient}}" >
                <view class="v1" >
                    <view class="top-des">当前就诊人</view>
                    <view class="top-name">{{defaultPatient.userName}}</view>
                </view>
                <view class="top-button" bindtap="bindPatientTap">
                    <van-icon name="exchange" size="30rpx" />
                    <view style="margin-left: 14rpx;color: #1a1a1a;">切换</view>
                </view>
            </block>
            <view class="top-right" wx:else bindtap="addPatientTap">
                <view style=" font-size: 30rpx;   color: #4071A1; margin-left: 20rpx;">添加就诊人</view>
            </view>
        </view>
    </view>
</van-sticky>
<van-grid custom-class="grid-class" border="{{false}}" clickable column-num="5" icon-size="40px">

    <van-grid-item icon="/image/home_icon_wdqy2.png" badge="{{myRightsCount>0?myRightsCount:''}}" bindtap='goMyRightsPage'>
        <view class="grid-title" slot="text">我的权益</view>
    </van-grid-item>
    <van-grid-item icon="/image/home_icon_zxzx.png" badge="{{unreadMymessageCount>0?unreadMymessageCount:''}}" bindtap='goMyMessagePage'>
        <view class="grid-title" slot="text">我的消息</view>
    </van-grid-item>
    <van-grid-item icon="/image/home_icon_sfwj.png" badge="" bindtap='goPackageListPage'>
        <view class="grid-title" slot="text">健康服务</view>
    </van-grid-item>
    <van-grid-item icon="/image/home_icon_jkjh.png" badge="" bindtap='goNewsListPage'>
        <view class="grid-title" slot="text">健康教育</view>
    </van-grid-item>
    <van-grid-item icon="/image/home_icon_jkjl.png" badge="{{unreadIMmessageCount>0?unreadIMmessageCount:''}}" bindtap='goIMPage'>
        <view class="grid-title" slot="text">在线咨询</view>
    </van-grid-item>

</van-grid>
<van-grid custom-class="grid-class2" border="{{false}}" clickable column-num="5" icon-size="40px">

    <van-grid-item icon="/image/home_icon_yyyj.png" bindtap='goTechnologyAppointPage'>
        <view class="grid-title" slot="text">预约医技</view>
    </van-grid-item>



</van-grid>








<!-- <view wx:if="{{lastConversation}}" class="notice-view" bindtap="bindLastConversationTap">
  <van-notice-bar left-icon="chat-o" wrapable scrollable="{{ false }}" text="{{lastConversation.userProfile.nick}}: {{lastConversation.lastMessage.messageForShow}}" />
</view> -->


<view class="todo-card">
    <view class="todo-title-view" bindtap="">
        <text class="todo-title">我的待办</text>
        <van-icon info="{{taskList.length>0?taskList.length:''}}" />
    </view>


    <block wx:for="{{taskList}}">
        <view class="todo-back" bindtap="onTaskItemClick" data-item="{{item}}">
            <van-icon name="/image/{{computed.taskType2(item.planType,item.execFlag).icon}}" dot="{{item.planType !== 'DailyRecord'}}" mode="scaleToFill" size="82rpx" class="todo-image" />
            <view class="todo-content">
                <view class="todo-name">{{computed.taskType2(item.planType,item.execFlag).title}}</view>
                <text class="todo-des">{{item.planDescribe||''}}</text>
            </view>
            <view class="todo-button">{{computed.taskType2(item.planType,item.execFlag).btnText}}</view>
        </view>
        <view wx:if="{{index+1 !== taskList.length}}" class="split" />
    </block>


</view>


<!-- 就诊人选择 -->
<van-popup show="{{ !hidePatientShow }}" round position="bottom" custom-style="padding-top:10rpx;min-height: 20%;max-height: 80%; " bind:close="closePatientTap">
    <van-picker custom-class="picker-custom" show-toolbar title="切换就诊人" cancel-button-text="添加" columns="{{ nameColumns }}" visible-item-count='4' bind:cancel="onPatientPickerCancel" bind:confirm="onPatientPickerConfirm" />
</van-popup>